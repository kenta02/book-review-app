openapi: 3.0.3
info:
  title: Book Review App API
  description: |
    æ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®REST APIä»•æ§˜

    ğŸ” èªè¨¼ã«ã¤ã„ã¦ï¼š
    - ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆğŸ”’ãƒãƒ¼ã‚¯ï¼‰ã«ã¯ Authorization ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå¿…è¦ã§ã™
    - Format: `Authorization: Bearer <JWT_TOKEN>`
  version: 1.0.0
  contact:
    name: Book Review App
  license:
    name: ISC

servers:
  - url: http://localhost:3001/api
    description: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

tags:
  - name: Auth
    description: èªè¨¼é–¢é€£
  - name: Books
    description: æ›¸ç±ç®¡ç†
  - name: Reviews
    description: ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†
  - name: Users
    description: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
  - name: Favorites
    description: ãŠæ°—ã«å…¥ã‚Šç®¡ç†
  - name: Comments
    description: ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWTèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: tanaka
        email:
          type: string
          format: email
          example: tanaka@example.com
        role:
          type: string
          enum: [user, admin]
          example: user

    Book:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: å¾è¼©ã¯çŒ«ã§ã‚ã‚‹
        author:
          type: string
          example: å¤ç›®æ¼±çŸ³
        publicationYear:
          type: integer
          example: 1905
        ISBN:
          type: string
          example: 9784101010014
        summary:
          type: string
        averageRating:
          type: number
          format: float
          example: 4.2
        reviewCount:
          type: integer
          example: 15
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Review:
      type: object
      properties:
        id:
          type: integer
        bookId:
          type: integer
        userId:
          type: integer
        username:
          type: string
        content:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        helpfulCount:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Comment:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        username:
          type: string
        content:
          type: string
        createdAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        currentPage:
          type: integer
        totalPages:
          type: integer
        totalItems:
          type: integer
        itemsPerPage:
          type: integer

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            message:
              type: string
            code:
              type: string

paths:
  /auth/register:
    post:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 150
                  example: tanaka
                email:
                  type: string
                  format: email
                  example: tanaka@example.com
                password:
                  type: string
                  minLength: 8
                  example: password123
      responses:
        '201':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '400':
          description: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«æ—¢å­˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: tanaka@example.com
                password:
                  type: string
                  example: password123
      responses:
        '200':
          description: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
        '401':
          description: èªè¨¼å¤±æ•—
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/me:
    get:
      summary: ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
      tags: [Auth]
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: æœªèªè¨¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /books:
    get:
      summary: æ›¸ç±ä¸€è¦§å–å¾—
      tags: [Books]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: search
          in: query
          schema:
            type: string
          description: ã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯è‘—è€…ã§æ¤œç´¢
        - name: minRating
          in: query
          schema:
            type: number
        - name: maxRating
          in: query
          schema:
            type: number
        - name: yearFrom
          in: query
          schema:
            type: integer
        - name: yearTo
          in: query
          schema:
            type: integer
        - name: sort
          in: query
          schema:
            type: string
            enum: [title, author, publicationYear, rating, createdAt]
        - name: order
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
      responses:
        '200':
          description: æ›¸ç±ä¸€è¦§å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      books:
                        type: array
                        items:
                          $ref: '#/components/schemas/Book'
                      pagination:
                        $ref: '#/components/schemas/Pagination'

    post:
      summary: æ›¸ç±è¿½åŠ 
      tags: [Books]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - author
              properties:
                title:
                  type: string
                author:
                  type: string
                publicationYear:
                  type: integer
                ISBN:
                  type: string
                summary:
                  type: string
      responses:
        '201':
          description: æ›¸ç±è¿½åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Book'
        '400':
          description: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
        '401':
          description: æœªèªè¨¼
        '409':
          description: ISBNæ—¢å­˜

  /books/{id}:
    get:
      summary: æ›¸ç±è©³ç´°å–å¾—
      tags: [Books]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æ›¸ç±è©³ç´°å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Book'
        '404':
          description: æ›¸ç±ãŒè¦‹ã¤ã‹ã‚‰ãªã„

    put:
      summary: æ›¸ç±æ›´æ–°
      tags: [Books]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                author:
                  type: string
                publicationYear:
                  type: integer
                ISBN:
                  type: string
                summary:
                  type: string
      responses:
        '200':
          description: æ›¸ç±æ›´æ–°æˆåŠŸ
        '403':
          description: æ¨©é™ä¸è¶³
        '404':
          description: æ›¸ç±ãŒè¦‹ã¤ã‹ã‚‰ãªã„

    delete:
      summary: æ›¸ç±å‰Šé™¤
      tags: [Books]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æ›¸ç±å‰Šé™¤æˆåŠŸ
        '403':
          description: æ¨©é™ä¸è¶³
        '404':
          description: æ›¸ç±ãŒè¦‹ã¤ã‹ã‚‰ãªã„

  /books/{bookId}/reviews:
    get:
      summary: ç‰¹å®šæ›¸ç±ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼å–å¾—
      tags: [Books]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: ãƒ¬ãƒ“ãƒ¥ãƒ¼å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      reviews:
                        type: array
                        items:
                          $ref: '#/components/schemas/Review'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
                      averageRating:
                        type: number
                      reviewCount:
                        type: integer
        '404':
          description: æ›¸ç±ãŒè¦‹ã¤ã‹ã‚‰ãªã„

  /reviews:
    get:
      summary: ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§å–å¾—
      tags: [Reviews]
      parameters:
        - name: bookId
          in: query
          schema:
            type: integer
        - name: userId
          in: query
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§å–å¾—æˆåŠŸ

    post:
      summary: ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿
      tags: [Reviews]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - bookId
                - content
                - rating
              properties:
                bookId:
                  type: integer
                content:
                  type: string
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
      responses:
        '201':
          description: ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿æˆåŠŸ
        '404':
          description: æ›¸ç±ãŒè¦‹ã¤ã‹ã‚‰ãªã„

  /reviews/{id}:
    get:
      summary: ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°å–å¾—
      tags: [Reviews]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      bookId:
                        type: integer
                      userId:
                        type: integer
                      username:
                        type: string
                      content:
                        type: string
                      rating:
                        type: integer
                      helpfulCount:
                        type: integer
                      comments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time

    put:
      summary: ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
      tags: [Reviews]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                bookId:
                  type: integer
                content:
                  type: string
                rating:
                  type: integer
      responses:
        '200':
          description: ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°æˆåŠŸ
        '403':
          description: æ¨©é™ä¸è¶³

    delete:
      summary: ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤
      tags: [Reviews]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤æˆåŠŸ

  /reviews/{id}/helpful:
    post:
      summary: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å½¹ã«ç«‹ã£ãŸã¨ã—ã‚‹
      tags: [Reviews]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: å½¹ã«ç«‹ã£ãŸã‚«ã‚¦ãƒ³ãƒˆè¿½åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      helpfulCount:
                        type: integer

  /users/{id}:
    get:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—
      tags: [Users]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                      username:
                        type: string
                      reviewCount:
                        type: integer
                      favoriteCount:
                        type: integer
                      createdAt:
                        type: string
                        format: date-time

  /users/{id}/reviews:
    get:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§
      tags: [Users]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§å–å¾—æˆåŠŸ

  /users/{id}/favorites:
    get:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŠæ°—ã«å…¥ã‚Šæ›¸ç±ä¸€è¦§
      tags: [Users]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ãŠæ°—ã«å…¥ã‚Šä¸€è¦§å–å¾—æˆåŠŸ

  /favorites:
    post:
      summary: ãŠæ°—ã«å…¥ã‚Šè¿½åŠ 
      tags: [Favorites]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - bookId
              properties:
                bookId:
                  type: integer
      responses:
        '201':
          description: ãŠæ°—ã«å…¥ã‚Šè¿½åŠ æˆåŠŸ

  /favorites/{bookId}:
    delete:
      summary: ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤
      tags: [Favorites]
      security:
        - BearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤æˆåŠŸ

  /comments:
    post:
      summary: ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿
      tags: [Comments]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reviewId
                - content
              properties:
                reviewId:
                  type: integer
                content:
                  type: string
                parentId:
                  type: integer
                  description: ãƒªãƒ—ãƒ©ã‚¤ã®å ´åˆã€è¦ªã‚³ãƒ¡ãƒ³ãƒˆID
      responses:
        '201':
          description: ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿æˆåŠŸ

  /comments/{id}:
    delete:
      summary: ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤
      tags: [Comments]
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤æˆåŠŸ
